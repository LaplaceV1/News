<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LN Tools — Premium Downloader</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#050507;
    --bg2:#0b0c10;
    --card:#0f1316;
    --muted: rgba(255,255,255,0.62);
    --gold:#D4A94E;
    --accent:#f7dba0;
    --border: rgba(255,255,255,0.05);
  }
  *{box-sizing:border-box}
  html,body{
    margin:0;padding:0;font-family:Poppins,Inter;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#eaeef2;
    -webkit-font-smoothing:antialiased;
  }
  .wrap{max-width:1100px;margin:40px auto;padding:20px}
  header{display:flex;align-items:center;gap:16px}
  .logo{
    width:70px;height:70px;border-radius:16px;
    background:linear-gradient(135deg,var(--gold),var(--accent));
    display:flex;align-items:center;justify-content:center;
    font-weight:800;font-size:26px;color:#111;
    box-shadow:0 12px 40px rgba(212,169,78,0.25);
  }
  h1{margin:0;font-size:24px}
  .tag{color:var(--muted);font-size:13px;margin-top:4px}

  .grid{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:30px}
  .card{
    background:rgba(255,255,255,0.03);
    padding:20px;border-radius:16px;border:1px solid var(--border);
    box-shadow:0 10px 40px rgba(2,6,12,0.5);
  }

  input,select{
    width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.04);
    border:1px solid rgba(255,255,255,0.06);color:white;font-size:14px;margin-bottom:12px;
  }
  button{
    cursor:pointer;border:none;border-radius:12px;font-weight:700;
    padding:12px 14px;
  }
  .btn-primary{
    background:linear-gradient(90deg,var(--gold),var(--accent));
    color:#111;box-shadow:0 8px 30px rgba(212,169,78,0.15);
  }
  .btn-ghost{
    background:transparent;color:var(--muted);
    border:1px solid rgba(255,255,255,0.08);
  }
  .row{display:flex;gap:10px;align-items:center}
  .meta{font-size:13px;color:var(--muted);margin-top:8px}

  .preview{display:none;align-items:center;gap:16px;margin-top:14px}
  .thumb{
    width:160px;height:92px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,0.08)
  }
  .title{font-size:17px;font-weight:700;margin-bottom:4px}
  .pill{
    display:inline-block;padding:5px 8px;border-radius:999px;background:rgba(255,255,255,0.06);
    font-size:11px;color:var(--muted);
  }

  #results{margin-top:18px}

  .format{
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.05);
    padding:12px;border-radius:14px;margin-bottom:12px;
    display:flex;align-items:center;justify-content:space-between;
  }
  .label{font-size:14px;font-weight:600}

  footer{text-align:center;margin-top:30px;color:var(--muted);font-size:13px}

  @media(max-width:900px){
    .grid{grid-template-columns:1fr}
    .thumb{width:100px;height:70px}
  }
</style>
</head>

<body>
<div class="wrap">

<header>
  <div class="logo">LN</div>
  <div>
    <h1>LN Tools</h1>
    <div class="tag">Premium Downloader — TikTok · Instagram · Facebook · YouTube</div>
  </div>
</header>

<div class="grid">

  <!-- LEFT -->
  <main class="card">
    <div class="small" style="margin-bottom:6px;color:var(--muted)">Tempel link video publik</div>

    <input id="url" type="text" placeholder="https://www.tiktok.com/..." />

    <div class="row">
      <select id="platform">
        <option value="auto">Auto</option>
        <option value="tiktok">TikTok</option>
        <option value="instagram">Instagram</option>
        <option value="facebook">Facebook</option>
        <option value="youtube">YouTube</option>
      </select>
      <button id="go" class="btn-primary">Get</button>
    </div>

    <div id="status" class="meta">Ready</div>

    <!-- preview -->
    <div id="preview" class="preview">
      <img id="thumb" class="thumb" src="">
      <div>
        <div id="title" class="title"></div>
        <div id="badge" class="pill"></div>
      </div>
    </div>

    <!-- dropdown & download -->
    <div id="qualityBox" style="margin-top:18px;display:none">

      <div class="small" style="margin-bottom:6px;color:var(--muted)">Pilih Kualitas</div>

      <select id="formatSelect"></select>

      <button id="downloadBtn" class="btn-primary" style="width:100%;margin-top:10px">
        Download
      </button>
    </div>

    <div id="err" style="color:#ffb8b8;margin-top:12px;display:none"></div>
  </main>

  <!-- RIGHT -->
  <aside class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <div><strong>History</strong></div>
      <button class="btn-ghost" id="clearHistory">Clear</button>
    </div>

    <div id="history" style="max-height:360px;overflow:auto"></div>

    <div class="small" style="margin-top:18px;color:var(--muted)">
      Sistem menggunakan proxy download <code>/api/download</code>
    </div>
  </aside>

</div>

<footer>LN Tools — Premium Downloader © 2025</footer>

</div>

<script>
const $ = id => document.getElementById(id);
const LS = "ln_history_v1";

function setStatus(msg){ $("status").textContent = msg; }
function showErr(msg){ $("err").style.display="block"; $("err").textContent=msg; }
function clearErr(){ $("err").style.display="none"; $("err").textContent=""; }

function saveHistory(u,p){
  let h = JSON.parse(localStorage.getItem(LS)||"[]");
  h.unshift({url:u, platform:p, t:Date.now()});
  if(h.length>60) h.pop();
  localStorage.setItem(LS, JSON.stringify(h));
}
function renderHistory(){
  const box = $("history");
  box.innerHTML = "";
  const h = JSON.parse(localStorage.getItem(LS)||"[]");
  if(!h.length){
    box.innerHTML = `<div class="small">Empty</div>`;
    return;
  }
  h.forEach((x,i)=>{
    const d = document.createElement("div");
    d.className="small";
    d.style.padding="8px";
    d.style.borderBottom="1px solid rgba(255,255,255,0.06)";
    d.style.cursor="pointer";
    d.innerHTML = `<b>${x.platform}</b><br>${x.url}<br>${new Date(x.t).toLocaleString()}`;
    d.onclick = ()=>{ $("url").value = x.url; $("go").click(); };
    box.appendChild(d);
  });
}

$("clearHistory").onclick = ()=>{ localStorage.removeItem(LS); renderHistory(); };

function detectPlatform(u){
  u = u.toLowerCase();
  if(u.includes("tiktok.com")||u.includes("vt.tiktok")) return "tiktok";
  if(u.includes("instagram.com")) return "instagram";
  if(u.includes("facebook.com")||u.includes("fb.watch")) return "facebook";
  if(u.includes("youtube.com")||u.includes("youtu.be")) return "youtube";
  return "unknown";
}

async function handle(){
  clearErr();
  setStatus("Fetching...");

  const url = $("url").value.trim();
  if(!url) return showErr("Masukkan URL");

  let plat = $("platform").value;
  if(plat==="auto") plat = detectPlatform(url);

  saveHistory(url, plat);
  renderHistory();

  try{
    const r = await fetch(`/api/extract?url=${encodeURIComponent(url)}`);
    const j = await r.json();
    if(!j.ok) return showErr("Gagal mengambil data");

    const data = j.data;

    // preview
    $("preview").style.display="flex";
    $("thumb").src = data.thumbnail || "";
    $("title").textContent = data.title || "Unknown";
    $("badge").textContent = data.platform;

    // format dropdown
    $("qualityBox").style.display="block";
    const sel = $("formatSelect");
    sel.innerHTML = "";
    data.formats.forEach(f=>{
      const o = document.createElement("option");
      o.value = f.url;
      o.textContent = f.label;
      sel.appendChild(o);
    });

    // download button
    $("downloadBtn").onclick = ()=>{
      const fURL = sel.value;
      const name = (data.title || "video").replace(/[^a-z0-9]/gi,"_") + ".mp4";
      const dURL = `/api/download?url=${encodeURIComponent(fURL)}&name=${encodeURIComponent(name)}`;
      window.location.href = dURL;
    };

    setStatus("Ready");
  }
  catch(e){
    console.log(e);
    showErr("Error: "+e);
    setStatus("Error");
  }
}

$("go").onclick = handle;
$("url").onkeydown = e=>{ if(e.key==="Enter") handle(); };

renderHistory();
setStatus("Ready");

</script>

</body>
</html>
